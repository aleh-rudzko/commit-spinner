<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Spinner</title>
    <link rel="stylesheet" href="/static/styles.css">
    <script
            src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>
</head>
<body>
<script src="/static/propeller.js"></script>
<script>
    $(document).ready(function () {
        var app = {};

        const addSpinner = (username, spinnerSpeed) => {
            const spinnerId = `spinner-${username}`;
            $('body').append(`<img id="${spinnerId}" class="spinner" src="/static/spinner.png" style="transform: rotate(0deg) translateZ(0px);">`);
            app[username] = {
                spinnerId: spinnerId,
                spinner: new Propeller(document.getElementById(spinnerId), {
                    inertia: 1,
                    speed: 100 * spinnerSpeed
                })
            };
        }

        $.get('https://wth2017.hypershape.club/speeds', function (data) {
            Object.keys(data).forEach(function (username) {
                const spinnerSpeed = data[username];
                addSpinner(username, spinnerSpeed);
            });
        });
        const interval = setInterval(function () {
            $.get('https://wth2017.hypershape.club/speeds', function (data) {
                Object.keys(data).forEach(function (username) {
                    const spinnerSpeed = data[username];
                    if (app.hasOwnProperty(username)) {
                        const spinner = app[username].spinner;
                        spinner.setSpeed(100 * spinnerSpeed);
                    } else {
                        addSpinner(username, spinnerSpeed);
                    }
                });
            });
        }, 3000);
    });
</script>

</body>
</html>